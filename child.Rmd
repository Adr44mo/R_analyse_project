---
title: "test"
author: "moi"
date: "2025-04-02"
output: html_document
---

---
title: "Projet"
author: "moi"
date: "2025-02-28"
output: html_document
keep_md: true
---

```{r, echo=FALSE, results='hide', message=FALSE, warning=FALSE}
#rmarkdown::render("Projet.Rmd", output_format = "pdf_document")
#rmarkdown::render("Projet.Rmd", output_format = "html_document")
```

# Projet : Analyse de donn√©es financi√®res

## 1. Introduction

### Pr√©sentation du jeu de donn√©es : "Market Cap"

Ce jeu de donn√©es contient des informations sur les plus grandes entreprises mondiales en termes de capitalisation boursi√®re. Il inclut diverses variables financi√®res et ESG (Environnement, Social et Gouvernance) qui permettent d‚Äôanalyser leur performance √©conomique et leur engagement en mati√®re de durabilit√©.

#### Structure du jeu de donn√©es

-   **Nombre de variables** : 45\
-   **Types de variables** :
    -   **Quantitatives** : marketCap (capitalisation boursi√®re), trailingPE (PER historique), forwardPE (PER futur), priceToBook (prix/valeur comptable), totalEsg (score ESG), etc.\
    -   **Qualitatives** : sector (secteur d‚Äôactivit√©), country (pays), peerGroup (groupe de pairs), esgPerformance (performance ESG), etc. Vous pouvez retrouver la description de chacune des variables dans l‚Äôannexe.

#### Probl√©matiques soulev√©es

1.  **Analyse de la capitalisation boursi√®re**
    -   Quels sont les secteurs les plus repr√©sent√©s parmi les entreprises ayant la plus grande capitalisation boursi√®re ?\
    -   Existe-t-il une corr√©lation entre la capitalisation et d‚Äôautres variables financi√®res (PER, price-to-book, etc.) ?
2.  **Performances ESG et responsabilit√© sociale**
    -   Quel est l‚Äôimpact des scores ESG sur la valorisation des entreprises ?\
    -   Les entreprises ayant une forte capitalisation boursi√®re ont-elles tendance √† avoir de meilleures performances ESG ?
3.  **Comparaisons sectorielles et g√©ographiques**
    -   Quels sont les pays qui dominent le classement des entreprises √† forte capitalisation ?\
    -   Comment les secteurs d‚Äôactivit√© diff√®rent-ils en termes de ratios financiers et d‚Äôengagement ESG ?
4.  **Analyse pr√©dictive et tendances**
    -   Peut-on pr√©dire la performance future d‚Äôune entreprise en fonction de ses indicateurs financiers et ESG ?\
    -   Existe-t-il des anomalies statistiques qui m√©riteraient une √©tude plus approfondie ?

```{r, echo=FALSE, results='hide'}
# Charger la librairie n√©cessaire
library(tidyverse)

# 1. Charger le fichier CSV
load_marketcap_data <- function() {
  file_path <- "Morille_Adrien_Malleret_Antoine_yahoo_finance.csv"  # Mets ici le chemin complet si n√©cessaire
  df_marketcap <- read.csv(file_path)
  return(df_marketcap)
}

# 2. Filtrer les lignes de 0 √† 1500
filter_data <- function(df_marketcap) {
  filtered_data <- df_marketcap[1:1500, ]
  return(filtered_data)
}

# 3. Enregistrer le r√©sultat dans un nouveau fichier CSV
save_to_csv <- function(filtered_data) {
  write.csv(filtered_data, "marketcap_0_1500.csv", row.names = FALSE)
}

# 4. Fonction principale

# Charger le fichier CSV
df_marketcap <- load_marketcap_data()
  
# Filtrer les lignes
filtered_data <- filter_data(df_marketcap)
  
# Sauvegarder dans un nouveau CSV
save_to_csv(filtered_data)



```

Netoyage des don√©es.

```{r, echo=FALSE, results='hide'}
# Charger la librairie n√©cessaire
library(tidyverse)

# 1. Charger le fichier CSV
file_path <- "marketcap_0_1500.csv"  # Mets ici le chemin complet si n√©cessaire
df <- read.csv(file_path)

# Aper√ßu des premi√®res lignes du fichier charg√©
head(df)

# 2. Supprimer les lignes vides
# Utilisation de drop_na() pour supprimer toutes les lignes contenant des NA
cleaned_data <- df %>% drop_na()
# supprimer les ligne avec des donn√©es manquantes
cleaned_data <- na.omit(df)
# supprimer les lignes avec des N/A
cleaned_data <- df[complete.cases(df),]
cleaned_data[cleaned_data == ""] <- NA
cleaned_data <- na.omit(cleaned_data)

# V√©rifier le nombre de lignes avant et apr√®s le nettoyage
cat("Nombre de lignes avant nettoyage :", nrow(df), "\n")
cat("Nombre de lignes apr√®s nettoyage :", nrow(cleaned_data), "\n")

# 3. Enregistrer le r√©sultat nettoy√© dans un nouveau fichier CSV
write.csv(cleaned_data, "marketcap_cleaned.csv", row.names = FALSE)
cat("‚úÖ Fichier 'marketcap_cleaned.csv' sauvegard√© avec succ√®s !\n")

# 5 supprimer les colonnes inutiles
# D√©finir Name comme nom de ligne et le supprimer du dataset
rownames(cleaned_data) <- cleaned_data$Name
cleaned_data$Name <- NULL
cleaned_data$Symbol <- NULL
cleaned_data$Rank <- NULL
cleaned_data$maxAge <- NULL
cleaned_data$ratingYear <- NULL
cleaned_data$ratingMonth <- NULL

# 5. Afficher les premi√®res lignes du tableau nettoy√©
head(cleaned_data)
```

Conversion des donn√©es en num√©rique.

```{r, echo=FALSE, results='hide'}
# V√©rifier les types des colonnes
str(cleaned_data)

# Identifier les colonnes quantitatives √† convertir
quantitative_columns <- c("marketCap", "previousClose", "trailingPE", "forwardPE", 
                          "priceToBook", "beta", "profitMargins", "enterpriseToRevenue", 
                          "enterpriseToEbitda", "totalRevenue", "revenuePerShare", 
                          "revenueGrowth", "grossMargins", "ebitdaMargins", "operatingMargins", 
                          "returnOnAssets", "returnOnEquity", "debtToEquity", "currentRatio", 
                          "quickRatio", "totalCash", "totalDebt", "bookValue", 
                          "fiveYearAvgDividendYield", "payoutRatio", 
                          "trailingAnnualDividendYield", "trailingAnnualDividendRate", 
                          "totalEsg", "environmentScore", "socialScore", "governanceScore")

# Convertir ces colonnes en numeric
cleaned_data[quantitative_columns] <- lapply(cleaned_data[quantitative_columns], function(x) {
  # Enlever les caract√®res non num√©riques comme les symboles mon√©taires, et les convertir en numeric
  as.numeric(gsub("[^0-9.-]", "", x))
})



# V√©rifier les types apr√®s conversion
str(cleaned_data)
```

## Analyse exploratoire des donn√©es

```{r, echo=FALSE}
# test les diff√©rent pays et donn√©e le nombre d'entreprise par pays
df <- cleaned_data
# Nombre d'entreprises par pays
df %>%
  group_by(country) %>%
  summarise(Count = n()) %>%
  arrange(desc(Count))

df %>%
  group_by(country) %>%
  summarise(Count = n()) %>%
  arrange(desc(Count)) %>%
  ggplot(aes(x = reorder(country, Count), y = Count, fill = country)) +
  geom_bar(stat = "identity") +
  coord_flip() +
  labs(title = "Nombre d'entreprises par pays", x = "Pays", y = "Nombre d'entreprises") +
  theme_minimal()
```

### 1. Corr√©lation entre la Marge B√©n√©ficiaire et le Ratio d'Endettement

Un scatter plot est pertinent pour analyser la relation entre deux variables financi√®res, comme *profitMargins* et *debtToEquity*, afin de visualiser s'il existe une corr√©lation entre la rentabilit√© et l'endettement.

```{r, echo=FALSE}
library(ggplot2)

ggplot(cleaned_data, aes(x = debtToEquity, y = profitMargins)) +
  geom_point(color = "purple", alpha = 0.6) +
  labs(title = "Relation entre Marge B√©n√©ficiaire et Ratio d'Endettement",
       x = "Ratio d'Endettement (Debt to Equity)",
       y = "Marge B√©n√©ficiaire (%)") +
  theme_minimal()
```

### 2. Distribution de la Capitalisation Boursi√®re par Secteur

Un boxplot est un excellent moyen de visualiser la distribution de la capitalisation boursi√®re par secteur, ce qui permet de comparer la taille des entreprises dans diff√©rents domaines d'activit√©.

```{r, echo=FALSE}
ggplot(cleaned_data, aes(x = sector, y = marketCap, fill = sector)) +
  geom_boxplot() +
  labs(title = "Distribution de la Capitalisation Boursi√®re par Secteur",
       x = "Secteur d'Activit√©",
       y = "Capitalisation Boursi√®re (en milliards USD)") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

### 3. Scores ESG par Continent

Un diagramme en violon pourrait √™tre int√©ressant pour analyser la distribution des scores ESG (*totalEsg*) en fonction des continents. Cela permettrait de visualiser les √©carts dans la performance ESG en fonction de la r√©gion g√©ographique.

```{r, echo=FALSE}
ggplot(cleaned_data, aes(x = Continent, y = totalEsg, fill = Continent)) +
  geom_violin(trim = FALSE) +
  labs(title = "Distribution des Scores ESG par Continent",
       x = "Continent",
       y = "Score ESG Total") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

### 4. Comparaison de la Rentabilit√© (ROA vs ROE)

Un graphique en nuage de points est une bonne mani√®re de comparer les deux indicateurs financiers, √† savoir le Return on Assets (ROA) et le Return on Equity (ROE), pour chaque entreprise.

```{r, echo=FALSE}
ggplot(cleaned_data, aes(x = returnOnAssets, y = returnOnEquity)) +
  geom_point(color = "blue", alpha = 0.6) +
  labs(title = "Comparaison de la Rentabilit√© des Actifs (ROA) et des Fonds Propres (ROE)",
       x = "Rentabilit√© des Actifs (ROA)",
       y = "Rentabilit√© des Fonds Propres (ROE)") +
  theme_minimal()
```

## ACP : Analyse en Composantes Principales

```{r, echo=FALSE}
library(ggplot2)
library(FactoMineR)  # Pour l'ACP

# Copier le dataset nettoy√©
clean_data <- cleaned_data

# Assigner les noms d'entreprises aux rownames et supprimer la colonne Name
rownames(clean_data) <- clean_data$Name
clean_data$Name <- NULL

# On garde toutes les donn√©es sans filtrer sur top_50 cette fois

# On identifie toutes les colonnes quantitatives pour l'ACP
quantitative_columns <- c("marketCap", "previousClose", "trailingPE", "forwardPE", 
                          "priceToBook", "beta", "profitMargins", "enterpriseToRevenue", 
                          "enterpriseToEbitda", "totalRevenue", "revenuePerShare", 
                          "revenueGrowth", "grossMargins", "ebitdaMargins", "operatingMargins", 
                          "returnOnAssets", "returnOnEquity", "debtToEquity", "currentRatio", 
                          "quickRatio", "totalCash", "totalDebt", "bookValue", 
                          "fiveYearAvgDividendYield", "payoutRatio", 
                          "trailingAnnualDividendYield", "trailingAnnualDividendRate", 
                          "totalEsg", "environmentScore", "socialScore", "governanceScore")

# S√©lection des variables quantitatives + les variables qualitatives pour habillage
data_perf <- clean_data[, c(quantitative_columns, "sector", "Index")]

# Effectuer l'ACP avec variables qualitatives en quali.sup
res_pca <- PCA(data_perf, graph = TRUE, scale.unit = TRUE, ncp = 5, quali.sup = c((length(quantitative_columns) + 1), (length(quantitative_columns) + 2)))

# Afficher les valeurs propres
print(res_pca$eig)
```

Analyse en Composantes Principales (ACP) 1Ô∏è‚É£ Variance expliqu√©e par les axes

```{r}
# R√©sum√© des valeurs propres
print(res_pca$eig)
```

Observations :

Dim 1 : environ 10 % de variance expliqu√©e. Dim 2 : +9 %, cumul 19 %. Dim 3 : +8 %, cumul 27 %. Dim 4 : +6.6 %, cumul 33 %. Dim 5 : +6.4 %, cumul 40 %. Conclusion : Les 5 premiers axes expliquent environ 40 % de l‚Äôinertie totale.

2Ô∏è‚É£ Contributions des variables par axe

```{r}
# Contributions des variables
print(res_pca$var$contrib)
```

üìä Axe 1 (Dim.1) Variables dominantes :

priceToBook, enterpriseToRevenue, enterpriseToEbitda (‚âà 98 %) Interpr√©tation : Axe li√© √† la valorisation (ratios financiers).

üìä Axe 2 (Dim.2) Variables dominantes :

totalRevenue (48 %) totalCash (55 %) grossMargins, ebitdaMargins, governanceScore Interpr√©tation : Axe de solidit√© financi√®re et rentabilit√©.

üìä Axe 3 (Dim.3) Variables dominantes :

totalEsg, socialScore, ebitdaMargins Interpr√©tation : Axe ESG et efficacit√© op√©rationnelle.

üìä Axe 4 (Dim.4) Variables dominantes :

currentRatio & quickRatio (\> 63 %) Interpr√©tation : Axe des liquidit√©s (sant√© √† court terme).

üìä Axe 5 (Dim.5) Variables dominantes :

trailingAnnualDividendYield & trailingAnnualDividendRate (\> 97 %) Interpr√©tation : Axe purement li√© au dividende.

4Ô∏è‚É£ Graphiques de l'ACP Graphique individus (habillage par Index)

```{r}
plot(res_pca, habillage = (length(quantitative_columns) + 2), select = "cos2 0.8", choix = "ind")
```

‚úÖ Conclusion Cette ACP permet de bien visualiser :

L‚Äôopposition entre valorisation, marges et politique de dividende. L‚Äôimpact de l‚ÄôESG dans la structure multidimensionnelle. La r√©partition h√©t√©rog√®ne des entreprises selon leur secteur et leur Index. Ce jeu de donn√©es est id√©al pour une analyse multidimensionnelle incluant des m√©thodes comme l‚ÄôACP (Analyse en Composantes Principales), la r√©gression lin√©aire et l‚ÄôANOVA.

## 2. Importation et pr√©traitement des donn√©es

Voir annex pour plus de d√©tails sur les variables du jeu de donn√©es et le code utilis√©e.

```{r, echo=FALSE}
#ACP sur l'esg
data_esg <- cleaned_data[, c("totalEsg", "environmentScore", "socialScore", "governanceScore","esgPerformance","sector")]

res_pca_esg <- PCA(data_esg, graph = T,scale.unit = TRUE, ncp = 5, quali.sup = c(5,6))
res_pca_esg$eig
plot(res_pca_esg, habillage = 5, select = "cos2 0.8",choix = c("ind"))
plot(res_pca_esg, habillage = 6, select = "cos2 0.95",choix = c("ind"))

```

# Classification non supervis√©e

üìå 1. Pr√©paration des donn√©es On pr√©pare les donn√©es en supprimant les variables inutiles et en s‚Äôassurant que les variables qualitatives sont bien en facteur.

```{r}
library(FactoMineR)
library(cluster)

# Charger les donn√©es nettoy√©es
data <- cleaned_data

# Suppression des colonnes non utiles (nom, symbole, index, etc.)
data <- data %>% select(-c(Continent))

# Convertir les variables qualitatives en facteur
data$sector <- as.factor(data$sector)
data$country <- as.factor(data$country)
data$esgPerformance <- as.factor(data$esgPerformance)

# V√©rification des NA et nettoyage
data <- na.omit(data)
```

üìå 2. Analyse Factorielle des Donn√©es Mixtes (FAMD) On utilise FAMD (Analyse Factorielle des Donn√©es Mixtes) pour g√©rer variables quantitatives et qualitatives.

```{r}
# FAMD sur les donn√©es
res_famd <- FAMD(data, graph = TRUE, ncp = 5)
```

```{r}
# Cercle des corr√©lations
plot(res_famd, choix = "quanti")

# Graphique des individus
plot(res_famd, choix = "ind")

# changer les dimensions
plot(res_famd, choix = "ind", axes = c(1,3),cos2 = 0.8)
```

üìå 3. Clustering avec k-means sur les premi√®res composantes On applique k-means pour regrouper les entreprises.

```{r}
# Afficher la variance expliqu√©e par dimension
print(res_famd$eig)

# Calculer la variance cumul√©e
variance_cumulee <- cumsum(res_famd$eig[, 2])
print(variance_cumulee)

```

```{r}
# S√©lection des 5 premi√®res dimensions
coord <- res_famd$ind$coord[, 1:5]

# Choix du nombre de clusters (m√©thode de l'inertie)
inertie.intra <- rep(0, 10)
for (k in 1:20) {
  kmeans_res <- kmeans(coord, centers = k, nstart = 100)
  inertie.intra[k] <- kmeans_res$tot.withinss / kmeans_res$totss
}

# Affichage du graphique pour choisir le bon nombre de clusters
plot(1:20, inertie.intra, type = "b", xlab = "Nb. de groupes", ylab = "% inertie intra")

# On choisit 3 groupes ici (√† ajuster selon le graphique)
kmeans_result <- kmeans(coord, centers = 3, nstart = 100)

# Ajout des clusters aux donn√©es
data_cluster <- cbind.data.frame(data, cluster = factor(kmeans_result$cluster))

# observer les clusters
table(data_cluster$cluster)


```

üìå 4. Classification Hi√©rarchique (CAH) avec HCPC On applique la Classification Ascendante Hi√©rarchique (CAH) pour v√©rifier si les groupes sont coh√©rents.

```{r}
# Lancer la CAH sur les r√©sultats de FAMD
cah_res <- HCPC(res_famd, nb.clust = -1, graph = TRUE)
```

üìå 5. Interpr√©tation des clusters On analyse les groupes obtenus.

```{r}
table(data_cluster$cluster)

# Moyennes des variables par cluster
aggregate(data_cluster, by = list(data_cluster$cluster), FUN = mean)


```

```{r}

# Contribution des variables aux axes, du plus au moins impactant
# Boucle sur toutes les dimensions
for (i in 1:ncol(res_famd$var$contrib)) {
  cat("\nDimension", i, ":\n")
  
  # Trier les contributions des variables pour la dimension i
  contributions <- sort(res_famd$var$contrib[, i], decreasing = TRUE)
  
  # Afficher les 5 premi√®res variables les plus influentes
  print(head(contributions, 5))
}


```

üîπ Interpr√©tation des dimensions 

1.Dimension 1 (Axe principal - Facteurs financiers)

- Regroupe des variables √©conomiques et financi√®res cl√©s (revenus, dividendes, valeur comptable).

- Repr√©sente la solidit√© financi√®re et la performance √©conomique d‚Äôune entreprise.

- Une forte valeur sur cet axe indique une entreprise avec une capitalisation boursi√®re √©lev√©e et de bons r√©sultats financiers.

2.Dimension 2 (Facteurs ESG et environnementaux)

- Met en avant les scores ESG (Environnement, Social, Gouvernance) et le secteur d'activit√©.

- Repr√©sente l'engagement des entreprises envers les pratiques durables et responsables.

- Une entreprise avec un score √©lev√© ici est bien not√©e sur les crit√®res ESG et est dans un secteur o√π ces aspects sont valoris√©s.

3.Dimension 3 (Marge et rentabilit√© sectorielle)

- Regroupe des indicateurs de rentabilit√© comme l'EBITDA, les marges op√©rationnelles et le secteur.

- Indique la capacit√© d‚Äôune entreprise √† g√©n√©rer des profits par rapport √† son secteur.

- Une valeur √©lev√©e ici correspond √† une entreprise tr√®s rentable dans son industrie.

4.Dimension 4 (Retour sur actifs et rendement des investissements)

- Focalise sur le retour sur actifs (ROA), le rendement sur investissements et l‚Äôappartenance √† un groupe sectoriel.

- Met en √©vidence les entreprises qui utilisent efficacement leurs ressources pour g√©n√©rer des profits.

- Une valeur forte ici sugg√®re une excellente gestion des actifs et un bon retour sur investissement.

5.Dimension 5 (Sant√© financi√®re et liquidit√©)

- Associe le secteur, la liquidit√© (current ratio, quick ratio) et le pays.

- Capture la capacit√© d‚Äôune entreprise √† faire face √† ses obligations financi√®res √† court terme.

- Une valeur √©lev√©e indique une entreprise avec une bonne gestion de sa tr√©sorerie et un faible risque de liquidit√©.

# Annexe : Explication des variables du jeu de donn√©es

Ce jeu de donn√©es contient des informations sur les principales entreprises mondiales en termes de capitalisation boursi√®re, incluant des indicateurs financiers, des ratios de performance et des scores ESG.

## Variables du jeu de donn√©es

### Informations g√©n√©rales

-   **Rank** : Classement de l'entreprise selon sa capitalisation boursi√®re.
-   **Name** : Nom de l'entreprise.
-   **Symbol** : Symbole boursier de l'entreprise.
-   **country** : Pays d'origine de l'entreprise.
-   **sector** : Secteur d'activit√© (ex : Technologie, Finance, Sant√©, etc.).
-   **Index** : Indice boursier auquel appartient l'entreprise (ex : S&P 500, Nasdaq).
-   **Continent** : Continent d'implantation de l'entreprise.

### Donn√©es de March√©

-   **marketCap** : Capitalisation boursi√®re totale de l'entreprise.
-   **previousClose** : Prix de cl√¥ture de l'action lors de la derni√®re session.
-   **trailingPE** : Ratio prix/b√©n√©fice bas√© sur les b√©n√©fices pass√©s.
-   **forwardPE** : Ratio prix/b√©n√©fice bas√© sur les b√©n√©fices estim√©s.
-   **priceToBook** : Ratio Prix/Valeur comptable.
-   **beta** : Mesure de la volatilit√© du titre par rapport au march√©.

### Performance Financi√®re

-   **profitMargins** : Marge b√©n√©ficiaire nette.
-   **enterpriseToRevenue** : Ratio Valeur d'Entreprise/Chiffre d'Affaires.
-   **enterpriseToEbitda** : Ratio Valeur d'Entreprise/EBITDA.
-   **totalRevenue** : Chiffre d'affaires total.
-   **revenuePerShare** : Chiffre d'affaires par action.
-   **revenueGrowth** : Croissance du chiffre d'affaires.
-   **grossMargins** : Marge brute.
-   **ebitdaMargins** : Marge EBITDA.
-   **operatingMargins** : Marge op√©rationnelle.

### Rentabilit√© et Gestion Financi√®re

-   **returnOnAssets (ROA)** : Rentabilit√© des actifs.
-   **returnOnEquity (ROE)** : Rentabilit√© des fonds propres.
-   **debtToEquity** : Ratio d'endettement.
-   **currentRatio** : Ratio de liquidit√© courante.
-   **quickRatio** : Ratio de liquidit√© imm√©diate.
-   **totalCash** : Montant total des liquidit√©s.
-   **totalDebt** : Montant total des dettes.
-   **bookValue** : Valeur comptable de l'entreprise.

### Dividendes et Rendement Actionnarial

-   **fiveYearAvgDividendYield** : Rendement moyen des dividendes sur 5 ans.
-   **payoutRatio** : Pourcentage des b√©n√©fices distribu√©s en dividendes.
-   **trailingAnnualDividendYield** : Rendement annuel des dividendes.
-   **trailingAnnualDividendRate** : Montant du dividende annuel par action.

### Donn√©es ESG (Environnement, Social, Gouvernance)

-   **totalEsg** : Score ESG total.
-   **environmentScore** : Score environnemental.
-   **socialScore** : Score social.
-   **governanceScore** : Score de gouvernance.
-   **ratingYear** : Ann√©e de notation ESG.
-   **ratingMonth** : Mois de notation ESG.
-   **highestControversy** : Niveau de controverse maximal associ√© √† l'entreprise.
-   **peerCount** : Nombre d'entreprises comparables pour l'√©valuation ESG.
-   **esgPerformance** : Cat√©gorie de performance ESG (ex : LEAD_PERF, AVG_PERF, LAG_PERF).
-   **peerGroup** : Groupe de comparaison sectoriel pour l'ESG.

------------------------------------------------------------------------
